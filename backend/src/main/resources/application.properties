# Database Configuration (PostgreSQL - shared across environments)
spring.datasource.url=${DB_URL:jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5433}/${DB_NAME:church_app}}
spring.datasource.username=${DB_USER:church_user}
spring.datasource.password=${DB_PASSWORD:church_password}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA & Hibernate Configuration
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true

# Flyway Configuration
spring.flyway.enabled=true
spring.flyway.url=${spring.datasource.url}
spring.flyway.user=${spring.datasource.username}
spring.flyway.password=${spring.datasource.password}
spring.flyway.baseline-on-migrate=false
spring.flyway.locations=classpath:db/migration

# Server Configuration
# Use PORT environment variable (set by Elastic Beanstalk) or default to 8083
server.port=${PORT:8083}
server.servlet.context-path=/api

# JWT Configuration
jwt.secret=your-super-secret-jwt-key-change-this-in-production-use-at-least-256-bits
# Access token expiration: 1 hour (3600000 ms) - short-lived for security
jwt.expiration=3600000
# Refresh token expiration: 90 days (7776000000 ms) - long-lived for persistent sessions
jwt.refresh-expiration=7776000000

# Google OAuth2 Configuration
# TODO: Replace with your actual Google OAuth credentials from Google Cloud Console
spring.security.oauth2.client.registration.google.client-id=${GOOGLE_CLIENT_ID:your-google-client-id}
spring.security.oauth2.client.registration.google.client-secret=${GOOGLE_CLIENT_SECRET:your-google-client-secret}
spring.security.oauth2.client.registration.google.scope=profile,email
# Google OAuth Redirect URI - Use environment variable for production
spring.security.oauth2.client.registration.google.redirect-uri=${GOOGLE_REDIRECT_URI:http://localhost:8083/api/oauth2/callback/google}

spring.security.oauth2.client.provider.google.authorization-uri=https://accounts.google.com/o/oauth2/auth
spring.security.oauth2.client.provider.google.token-uri=https://oauth2.googleapis.com/token
spring.security.oauth2.client.provider.google.user-info-uri=https://www.googleapis.com/oauth2/v2/userinfo
spring.security.oauth2.client.provider.google.user-name-attribute=email

# Frontend URL - Used for OAuth redirects
frontend.url=${FRONTEND_URL:http://localhost:3000}

# CORS Configuration
# Production origins should be set via CORS_ORIGINS environment variable
# Development origins are included as fallback
cors.allowed-origins=${CORS_ORIGINS:http://localhost:3000,http://localhost:3001,http://localhost:8100,capacitor://localhost,http://localhost}
cors.allowed-methods=GET,POST,PUT,DELETE,PATCH,OPTIONS
cors.allowed-headers=*
cors.allow-credentials=true

# AWS S3 Configuration (replace with your actual credentials)
aws.access-key-id=${AWS_ACCESS_KEY_ID:your-aws-access-key-id}
aws.secret-access-key=${AWS_SECRET_ACCESS_KEY:your-aws-secret-access-key}
aws.region=${AWS_REGION:us-west-2}
aws.s3.bucket-name=${AWS_S3_BUCKET:church-app-uploads-stevensills2}

# AWS CloudFront Configuration (for fast video/media delivery)
# Set AWS_CLOUDFRONT_DISTRIBUTION_URL in production (e.g., https://d1234567890.cloudfront.net)
# If not set, falls back to direct S3 URLs
aws.cloudfront.distribution-url=${AWS_CLOUDFRONT_DISTRIBUTION_URL:}

# AWS Account ID (required for MediaConvert role ARN)
# Set AWS_ACCOUNT_ID environment variable (e.g., 123456789012)
aws.account-id=${AWS_ACCOUNT_ID:}

# File Upload Configuration - Updated to 150MB for resources
spring.servlet.multipart.max-file-size=150MB
spring.servlet.multipart.max-request-size=150MB

# Media Processing Configuration (Facebook/X Approach)
# File Upload Limits (before processing)
# 75MB allows ~30s videos at ~1MB/s with buffer
media.upload.image.max-size=20971520
media.upload.video.max-size=78643200
media.upload.audio.max-size=10485760
media.upload.document.max-size=157286400

# Image Processing
media.image.max-width=1920
media.image.max-height=1920
media.image.jpeg-quality=0.85
media.image.strip-exif=true
media.image.convert-heic=true

# Video Processing
media.video.target-width=854
media.video.target-height=480
media.video.bitrate=1000
media.video.audio-bitrate=128
media.video.frame-rate=30
media.video.max-duration-seconds=30

# Cleanup Configuration
media.cleanup.enabled=true
media.cleanup.original-retention-hours=24
media.cleanup.schedule-cron=0 0 2 * * ?
media.cleanup.retry-schedule-cron=0 0 */6 * * ?

# Processing Configuration
media.processing.async.enabled=true
media.processing.async.core-pool-size=2
media.processing.async.max-pool-size=4
media.processing.async.queue-capacity=100

# Cleanup Configuration
media.cleanup.original-retention-hours=24
media.cleanup.enabled=true
media.cleanup.schedule-cron=0 0 2 * * ?

# Stripe Configuration
stripe.public.key=${STRIPE_PUBLIC_KEY:pk_test_your-stripe-public-key}
stripe.secret.key=${STRIPE_SECRET_KEY:sk_test_your-stripe-secret-key}
stripe.webhook.secret=${STRIPE_WEBHOOK_SECRET:whsec_your-webhook-secret}

# Email Configuration for Receipts
spring.mail.host=${SMTP_HOST:smtp.gmail.com}
spring.mail.port=${SMTP_PORT:587}
spring.mail.username=${SMTP_USERNAME:your-email@example.com}
spring.mail.password=${SMTP_PASSWORD:your-app-password}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true

# Church Configuration for Receipts
church.name=${CHURCH_NAME:Sample Church}
church.address=${CHURCH_ADDRESS:123 Main St, City, State 12345}
church.phone=${CHURCH_PHONE:(555) 123-4567}
church.email=${CHURCH_EMAIL:info@samplechurch.org}
church.website=${CHURCH_WEBSITE:www.samplechurch.org}
church.tax-id=${CHURCH_TAX_ID:00-0000000}

# Logging Configuration
# Use production profile for less verbose logging in production
logging.level.com.churchapp.security=${LOG_LEVEL_SECURITY:DEBUG}
logging.level.org.springframework.security=${LOG_LEVEL_SPRING_SECURITY:INFO}
logging.level.com.churchapp.controller=${LOG_LEVEL_CONTROLLER:DEBUG}
logging.level.com.churchapp.dto=${LOG_LEVEL_DTO:DEBUG}
logging.level.com.churchapp.service=${LOG_LEVEL_SERVICE:INFO}
logging.level.com.churchapp.service.PostService=${LOG_LEVEL_POST_SERVICE:INFO}
logging.level.root=${LOG_LEVEL_ROOT:INFO}

# Jackson Configuration for proper timestamp serialization
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.deserialization.fail-on-unknown-properties=false
# Use system default timezone instead of forcing UTC to avoid date offset issues
# spring.jackson.time-zone=UTC

# Actuator Configuration
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when-authorized

# Disable @Configuration class proxying (avoids CGLIB enhancement issues)
spring.main.proxy-bean-methods=false

# Debug Spring Boot Auto-configuration - Removed for production